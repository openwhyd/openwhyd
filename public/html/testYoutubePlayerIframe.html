<!doctype html>
<!-- downloaded from http://metrics.whyd.com/hack.html -->
<html>
  <head>
    <title>Hack</title>
    <script>
      function postMessage(method, args) {
        document
          .getElementById('track')
          .contentWindow.postMessage(
            JSON.stringify({ code: method, data: args }),
            'http://adrienjoly.tumblr.com/post/80167551383/iframe-test',
          );
      }

      window.addEventListener('message', function (e) {
        if (e.origin === 'http://adrienjoly.tumblr.com') {
          var message = JSON.parse(e.data);
          console.log(
            '[host] receives from:',
            e.origin,
            message.code,
            message.data,
          );
          if (message.code === 'getTrackPositionCallback')
            document.getElementById('time').innerHTML = 'Time:' + message.data;
        }
      });

      setInterval(function () {
        postMessage('getTrackPosition');
      }, 1000);
    </script>
  </head>

  <body>
    <button onclick="postMessage('play', ['qrO4YZeyl0I'])">play gaga</button>
    <button onclick="postMessage('play', ['ehcVomMexkY'])">play rihanna</button>
    <button onclick="postMessage('pause')">pause</button>
    <button onclick="postMessage('resume')">resume</button>
    <button onclick="postMessage('stop')">stop</button>
    <iframe
      id="track"
      src="http://adrienjoly.tumblr.com/post/80167551383/iframe-test"
    ></iframe>
    <span id="time">Time: 0</span>
  </body>
  <!-- content of http://adrienjoly.tumblr.com/post/80167551383/iframe-test, from tumblr account:
    // <![CDATA[              var player = new YoutubePlayer({}, {         playerContainer: document.getElementById('player')       });              var origin = window.location.protocol + "//localhost:8080"; //"//run.jsbin.io";       console.log("[iframe] expected origin:", origin);        window.addEventListener('message', function(e) {         if (e.origin == origin) {           var message = JSON.parse(e.data);           var method = message.code;           var args = message.data;           console.log("[iframe]", e.origin, "is calling", method);           if (typeof player[method] === 'function') {             if (method === 'getTrackPosition') {               player.getTrackPosition(function(pos) {                 console.log(pos);                 parent.window.postMessage(                   JSON.stringify({code: 'getTrackPositionCallback', data: pos}), origin                 );               });             } else {               player[method].apply(player, args);             }           }         }       });      // ]]>
  -->
</html>
