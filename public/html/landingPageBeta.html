<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" /> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="cache-control" content="no-cache"/>
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="expires" content="0" />
  <title>{{title}}</title>
  <link rel="image_src" href="{{urlPrefix}}/images/logo-black-square-smaller.png"/>
  <meta property="og:image" content="{{urlPrefix}}/images/logo-black-square-smaller.png" />
  <meta property="og:description" content="A cool way to share your interests with people sharing the same interests" />
  <link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <link href="/images/favicon.png" rel="icon" type="image/png" />
  <link href="/css/ui.css" rel="stylesheet" type="text/css" />
  <link href="/css/loggingDialogs.css" rel="stylesheet" type="text/css" />
  <script src="/js/jquery-1.8.2.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/js/jquery.placeholder.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/js/jquery.simplemodal.1.4.4.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/js/jquery.iframe-post-form.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="/js/ui.js" type="text/javascript" charset="utf-8"></script>
  <style type="text/css">
	/*<![CDATA[*/
	
	body {
		margin: 0 auto;
		text-align: center;
		padding: 0;
		background: black url(/images/background.png);
		font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
		color: #3F3E3E;
	}
	
	a {
		color: #3778B8;
		text-decoration: none;
	}
	
	body > a {
		display: block;
		margin: 60px 0;
		font-size:14px;
		color: white;
		text-shadow: black 0px -1px 1px;
	}
	
	body > a:hover{
		text-decoration: underline;
	}
	
	/* messageBox */
	
	#messageBox {
		position: absolute;
		background: #faf7e3;
		width: 100%;
		line-height: 60px;
		border-bottom: 2px solid #f0ecd0;
		color: #363636;
		text-shadow: 0 1px 0 rgba(255,255,255,1);
		line-height: 60px;
		font-size: 14px;
	}
	
	#messageBox > div {
		position:relative;
		margin: 0 auto;
		width: 500px;
		height: 72px;
	}
	
	#messageBox > div > span {
		line-height: 75px;	
	}
	
	#mainContent {
		margin: 0 auto;
		margin-top: 100px;
	}
	
	#registerBox {
		position: relative;
		clear:both;
		width: 100%;
		padding-top:40px;
		margin-bottom: 60px;
	}
	
	#registerBox > div {
		background: #fcfcfc;
		background-image: url(/images/gradient-box-landing.png);
		background-repeat: repeat-x;
		background-position: bottom;
		width: 378px;
		height: 140px;
		border: 1px solid #b3b3b3;
		margin: 0 auto;
		margin-bottom: 60px;
		border-radius: 3px;
		-webkit-border-radius: 3px;
		-moz-border-radius: 3px;
		box-shadow: 0 0 2px rgba(0,0,0,0.30);
		-webkit-box-shadow: 0 0 2px rgba(0,0,0,0.30);
		-moz-box-shadow: 0 0 2px rgba(0,0,0,0.30);
	}
	
	#registerBox h3 {
		padding: 24px 10px;
		margin:0;
		line-height: 16px;
		font-size:14px;
		text-shadow: 0 1px 0 rgba(255,255,255,1);
		font-weight: normal;
		border: none;
	}
	
	input.box {
		margin-left: 10px;
		float: left;
		height: 36px;
		border: 1px solid #A5ACB1aaa;
		border-radius: 3px;
		-webkit-border-radius: 3px;
		-moz-border-radius: 3px;
		-webkit-background-clip: padding-box;
		-moz-background-clip: padding-box;
		-background-clip: padding-box;
		padding: 0 8px;
		height: 38px;
		width: 140px;
		font-size: 14px;
		color: #A7A7A7;
		line-height: 16px;
		box-shadow: inset 0 1px 2px rgba(0,0,0,0.25);
		-webkit-box-shadow: inset 0 1px 2px rgba(0,0,0,0.25);
		-moz-box-shadow: inset 0 1px 2px rgba(0,0,0,0.25);
	}
	
	input.box:focus {
		margin-left: 10px;
		float: left;
		color: #3F3E3E;
		outline-style: #2577bc;
		border: 1px solid #2577bc;
		-webkit-box-shadow: 0px 0px 4px #2577bc;
		-moz-box-shadow: 0px 0px 4px #2577bc;
		box-shadow: 0px 0px 4px #2577bc;
		-webkit-transition: border .3s, -webkit-box-shadow .3s;
		-moz-transition: border .3s, -webkit-box-shadow .3s;
		-o-transition: border .3s, -webkit-box-shadow .3s;
		transition: border .3s, -webkit-box-shadow .3s;
	}
	
	input#submit {
		display: inline;
		background: url(/images/btn-go-landing.png) no-repeat;
		cursor: pointer;
		height: 40px;
		width: 54px;
		color: transparent;
		border: none;
	}
	
	.clearer{
		clear: both;
	}
	
	
	input#submit:hover {
		background: url(/images/btn-go-landing.png) 0 -41px;
	}
	
	input#submit:active {
		background: url(/images/btn-go-landing.png) 0 -82px;
	}
	
	form {
		border: none;
		margin: 0;
	}
	
	
	/*]]>*/
  </style>
  <script src="/js/whydtr.js"></script>
</head>
<body>
	{{#message}}
	<div id="messageBox">
		<div>
			<span>{{text}}</span>
		</div>
	</div>
	{{/message}}
 
	<div id="mainContent">
		<img src='/images/logo_grad.png' />
	</div>
	
	
	<div id="registerBox">
		<div>
			<h3>Enter your email, we'll show you something cool</h3>
			<form id="askInvite" method="get" action="/thanks" onsubmit="return false;">
				<input class="box" type="text" id="mail" name="mail" placeholder="you@mail.com" style="width:280px;">
				<input id="submit" type="submit" value="go">
				<div class="clearer"></div>
				<div id="share" style="display:none;margin-top:20px;margin-left:15px;">
					<a href="http://twitter.com/share" class="twitter-share-button" data-url="http://openwhyd.org" data-text="I just signed up for @open_whyd, ask for an invite!" data-count="none" data-via="open_whyd">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
					<iframe src="http://www.facebook.com/plugins/like.php?href=http%3A%2F%2Fopenwhyd.org&amp;layout=button_count&amp;show_faces=false&amp;width=100&amp;action=like&amp;font&amp;colorscheme=light&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:100px; height:21px; position:relative; top:1px; left:10px;" allowTransparency="true"></iframe>
				</div>
			</form>
		</div>
	</div>

	<a href="javascript:login()">Already a member? Click here to sign in!</a>
	
	{{{loggingDialogs}}}
	
	<div id="fb-root"></div>
	
	<form id="fbForm" action="/facebookLogin" method="post">
		<input type="hidden" name="fbUid" value="" />
	</form>
	
	<script src="/js/facebook.js?54" type="text/javascript" charset="utf-8"></script>
	
	<script>
	//<![CDATA[
		// if ("{{loggedUid}}" != "")
		//	window.location.href = "{{whydUrl}}"; 
		
		var email = $("#mail").placeholder();
		var defVal = email.attr("placeholder");
		var emailCheck = /[a-z0-9!#$%'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i;

		var backtonormal = function() {
			email.css({"background-color":"#ffffff"});
		};
		
		$("#askInvite").submit( function(event) {
			event.preventDefault();
			if (email.val() == defVal || !emailCheck.test(email.val()))
				email.css({"background-color":"#ffa9a9"})
					.click(backtonormal).keydown(backtonormal);
			else
				$.ajax({
					type: "GET",
					url: "/login",
					data: {mail: email.val()},
					success: function(res) {
						var res = res || {};
						$("#askInvite input").fadeOut(function() {
							$("#askInvite").parent().animate({width:"200px"})
								.find("h3").html(res.result);
							if (res.redirect)
								window.location.href = res.redirect;
							else
								$("#share").fadeIn();
						});
					}
				});
			return false;
		});
		
		function login() {
			var $container = $(".dialogs").height($(".dlgSignIn").height());
			openHtmlDialog($container);
			switchToDialog(1); // => $form
			prepareForm($form); // => $email
			$email.val(email.val());
			$form.find(".dlgButtons p").html('...or <a href="javascript:fbConnect()">connect with facebook</a>');
		}
		
		
		function fbConnect() {
			fbLogin(function(fbUser) {
				if (!fbUser) return console.log("no fb login");
				
				// try to logging in using fbUid and fb cookie
				var $fbForm = $("#fbForm")
				$fbForm.find("input[name=fbUid]").val(fbUser.id);
				
				var fbFormHandler = { complete : function (res) {
						res = res.substring(res.indexOf('{'), res.lastIndexOf('}')+1);
						res = JSON.parse(res);
						console.log("response", res);
						if (res.redirect)
							//console.log("redirect to ", res.redirect);
							window.location.href = res.redirect;
						else {
							console.log("error", res.error);
							// new user ?
						} 
					}
				};
				$fbForm.iframePostForm (fbFormHandler).submit();
			}/*, 'email'*/);
		}
		
	//]]>
	</script>
</body>
</html>